# é¡¹ç›®-ç™¾åº¦selenium grid

## ç¯å¢ƒé…ç½®

é€šè¿‡gitä¸‹è½½åˆ°æœ¬åœ°

```
git clone https://github.com/HaiWenShangJing/selenium-project.git
```

åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–

```
# å¯åŠ¨è™šæ‹Ÿç¯å¢ƒï¼ˆWindowsï¼‰
python -m venv venv
venv\Scripts\activate
# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹

å¯åŠ¨selenium grid

```bash
docker-compose up -d
```

é…ç½®config.jsonï¼ˆå¯é€‰ï¼‰

æ‰§è¡Œæµ‹è¯•å‘½ä»¤

```bash
pytest
```

æŸ¥çœ‹æ•ˆæœ

æœ¬åœ°http://localhost:4444

![image.png](image.png)

æ‰§è¡Œä¸­

![image.png](image%201.png)

æ‰§è¡Œç»“æŸ

```bash
(venv) PS C:\Users\Jack\source\selenium_grid_test> pytest
============================================ test session starts ============================================
platform win32 -- Python 3.11.2, pytest-8.3.5, pluggy-1.5.0 -- C:\Users\Jack\source\selenium_grid_test\venv\Scripts\python.exe
cachedir: .pytest_cache
metadata: {'Python': '3.11.2', 'Platform': 'Windows-10-10.0.22621-SP0', 'Packages': {'pytest': '8.3.5', 'pluggy': '1.5.0'}, 'Plugins': {'html': '4.1.1', 'metadata': '3.1.1'}}
rootdir: C:\Users\Jack\source\selenium_grid_test
configfile: pytest.ini
testpaths: tests/
plugins: html-4.1.1, metadata-3.1.1
collected 6 items

tests/test_baidu_search.py::test_baidu_search_without_login[chrome] PASSED                             [ 16%]
tests/test_baidu_search.py::test_baidu_search_without_login[edge] PASSED                               [ 33%]
tests/test_baidu_search.py::test_baidu_search_without_login[firefox] PASSED                            [ 50%]
tests/test_baidu_search.py::test_baidu_search_with_login[chrome] SKIPPED (æ²¡æœ‰æœ‰æ•ˆçš„ç™»å½•cookieï¼Œè·³...) [ 66%]
tests/test_baidu_search.py::test_baidu_search_with_login[edge] SKIPPED (æ²¡æœ‰æœ‰æ•ˆçš„ç™»å½•cookieï¼Œè·³è¿‡...) [ 83%]
tests/test_baidu_search.py::test_baidu_search_with_login[firefox] SKIPPED (æ²¡æœ‰æœ‰æ•ˆçš„ç™»å½•cookieï¼Œ...)  [100%]

- Generated html report: file:///C:/Users/Jack/source/selenium_grid_test/reports/test_report_20250330_214156.html -
======================================= 3 passed, 3 skipped in 34.93s ======================================= 
(venv) PS C:\Users\Jack\source\selenium_grid_test> 
```

## é¡¹ç›®ç»“æ„

```
c:\Users\Jack\source\selenium_grid_test\
â”œâ”€â”€ ğŸ“‚ pages\                          # é¡µé¢å¯¹è±¡å°è£…
â”‚   â”œâ”€â”€ baidu_page.py                 # ç™¾åº¦æœç´¢é¡µæ“ä½œ
â”‚   â””â”€â”€ search_result_page.py         # æœç´¢ç»“æœé¡µæ“ä½œ
â”‚
â”œâ”€â”€ ğŸ“‚ tests\                         # æµ‹è¯•ç”¨ä¾‹ç›®å½•
â”‚   â””â”€â”€ test_baidu_search.py          # ç™¾åº¦æœç´¢æµ‹è¯•ç”¨ä¾‹
â”‚
â”œâ”€â”€ ğŸ“‚ reports\                       # æµ‹è¯•æŠ¥å‘Šå­˜å‚¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ test_report_*.html            # HTMLæŠ¥å‘Š
â”‚   â””â”€â”€ screenshots\                  # å¤±è´¥æˆªå›¾
â”‚
â”œâ”€â”€ docker-compose.yml                # Docker Grid é…ç½® â† æ–°å¢çš„æ ¸å¿ƒæ–‡ä»¶
â”‚   â”œâ”€â”€ selenium-hub                 # Grid ä¸­å¿ƒèŠ‚ç‚¹ï¼ˆ4444ç«¯å£ï¼‰
â”‚   â”œâ”€â”€ chrome-node                  # Chrome èŠ‚ç‚¹ï¼ˆ5900 VNCï¼‰
â”‚   â”œâ”€â”€ firefox-node                 # Firefox èŠ‚ç‚¹
â”‚   â””â”€â”€ edge-node                    # Edge èŠ‚ç‚¹
â”‚
â”œâ”€â”€ conftest.py                       # pytest æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ driver()                      # æµè§ˆå™¨é©±åŠ¨fixture
â”‚   â”œâ”€â”€ grid_url()                    # Grid åœ°å€é…ç½®
â”‚   â””â”€â”€ æŠ¥å‘Šç³»ç»Ÿé…ç½®
â”‚
â”œâ”€â”€ pytest.ini                        # pytest è¿è¡Œé…ç½®
â”œâ”€â”€ config.json                       # Cookie é…ç½®æ–‡ä»¶
â””â”€â”€ requirements.txt                  # Python ä¾èµ–åº“

[pytest æµ‹è¯•] â†’ [Selenium Grid] â†’ [æµè§ˆå™¨èŠ‚ç‚¹]
       â†‘               â†‘
    (conftest)    (docker-compose)
       â†“               â†“
[ç”ŸæˆæŠ¥å‘Š] â†â”€â”€ [æˆªå›¾/æ—¥å¿—] â†â”€â”€ [å®é™…æµè§ˆå™¨]
```

## é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          pytest å‘½ä»¤           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½é…ç½®                   â”‚
â”‚   c:\...\pytest.ini          â”‚
â”‚   â†’ è¯»å–å‘½ä»¤è¡Œå‚æ•°å’Œå…¨å±€è®¾ç½®     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ              â”‚
â”‚   c:\...\conftest.py          â”‚
â”‚   â†’ æ³¨å†Œfixtures(driverç­‰)     â”‚
â”‚   â†’ é…ç½®HTMLæŠ¥å‘Šè·¯å¾„           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æµ‹è¯•å‘ç°é˜¶æ®µ               â”‚
â”‚   c:\...\tests\              â”‚
â”‚   â†’ æ‰«ætest_*.pyæ–‡ä»¶         â”‚
â”‚   â†’ å¯¼å…¥pagesåŒ…              â”‚
â”‚     c:\...\pages\__init__.py â”‚
â”‚     â†’ æš´éœ²BaiduPageç­‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æµ‹è¯•æ‰§è¡Œæµç¨‹               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘  driver fixtureåˆå§‹åŒ–       â”‚
â”‚   â†’ åˆ›å»ºè¿œç¨‹WebDriverå®ä¾‹      â”‚
â”‚   â†’ è¿æ¥Selenium Grid:4444    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘¡ æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹                â”‚
â”‚   test_baidu_search.py        â”‚
â”‚   â†’ æ‰“å¼€ç™¾åº¦é¡µé¢               â”‚
â”‚   â†’ æœç´¢æ“ä½œ â†’ éªŒè¯ç»“æœ        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘¢ é’©å­å‡½æ•°æ‹¦æˆª                â”‚
â”‚   â†’ å¤±è´¥æ—¶æˆªå›¾ â†’ è¿½åŠ åˆ°æŠ¥å‘Š     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š               â”‚
â”‚   c:\...\reports\            â”‚
â”‚   â†’ HTMLæŠ¥å‘Š+æˆªå›¾             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. èµ„æºæ¸…ç†                  â”‚
â”‚   â†’ å…³é—­æµè§ˆå™¨å®ä¾‹(driver.quit)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡¹ç›®å‚æ•°ä¼ é€’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       æ‰§è¡Œ pytest å‘½ä»¤          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½ conftest.py çš„ fixturesâ”‚
â”‚   â‘  grid_url()               â”‚
â”‚     â†’ è¿”å› "http://localhost:4444" (session ä½œç”¨åŸŸ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å‚æ•°åŒ–é©±åŠ¨åˆå§‹åŒ–            â”‚
â”‚   â‘¡ driver(request, grid_url) â”‚
â”‚     â†’ request.param æ¥æ”¶å‚æ•° ['chrome', 'edge', 'firefox']
â”‚     â†’ grid_url æ¥è‡ªä¸Šä¸€æ­¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æµ‹è¯•å‡½æ•°å‚æ•°æ³¨å…¥            â”‚
â”‚   test_baidu_search_with_loginâ”‚
â”‚   (driver, cookies)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°ä¼ é€’é“¾ï¼š                  â”‚
â”‚ driver â†’ éœ€è¦ grid_url         â”‚
â”‚ cookies â†’ éœ€è¦ load_cookies()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. fixture ç”Ÿå‘½å‘¨æœŸ           â”‚
â”‚   grid_url: session ä½œç”¨åŸŸ    â”‚ åªåˆ›å»º1æ¬¡
â”‚   driver: function ä½œç”¨åŸŸ      â”‚ æ¯ä¸ªæµ‹è¯•å‡½æ•°åˆ›å»º3æ¬¡ï¼ˆ3æµè§ˆå™¨ï¼‰
â”‚   cookies: function ä½œç”¨åŸŸ    â”‚ æ¯ä¸ªæµ‹è¯•å‡½æ•°åˆ›å»º1æ¬¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
# conftest.py ä¸­å®šä¹‰
@pytest.fixture(scope="session")          # â† æœ€å…ˆè¢«è°ƒç”¨
def grid_url():                           # 1
    return "http://localhost:4444"        # 2 â†’ ä¼ é€’ç»™ â†“

@pytest.fixture(params=['chrome', 'edge', 'firefox'])
def driver(request, grid_url):            # 3 â† æ¥æ”¶ grid_url
    browser = request.param               # 4 â† æ¥æ”¶å‚æ•°åŒ–å€¼
    # åˆ›å»ºå¯¹åº”æµè§ˆå™¨çš„ driver â†’ ä¼ é€’ç»™ â†“

# test æ–‡ä»¶ä¸­ä½¿ç”¨
def test_baidu_search_with_login(driver, cookies):  # 5 â† æ¥æ”¶ driver å’Œ cookies
    # driver å·²åŒ…å« grid_url é…ç½®å’Œæµè§ˆå™¨å‚æ•°
    # cookies æ¥è‡ªç‹¬ç«‹çš„ cookies fixture
```

é¡µé¢å¯¹è±¡(pagesé‡Œçš„)ä¸ç›´æ¥å‚ä¸ pytest çš„å‚æ•°ä¼ é€’ä½“ç³»ï¼Œè€Œæ˜¯é€šè¿‡testsé‡Œçš„æ„é€ å‡½æ•°æ¥æ”¶å·²åˆå§‹åŒ–çš„ driver